<!DOCTYPE html>
<html lang="en">
<head>
  <title>Movie Searching Tool</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.16/p5.js"></script>
  <script src="../../../lib/codemirror.js"></script>
  <link rel="stylesheet" href="../../../lib/codemirror.css">
   <script src="../../../addon/active-line.js"></script>
   <script src="../../../mode/javascript.js"></script>
  <style>
	.CodeMirror {border-top: 1px solid black; border-bottom: 1px solid black;}
	.description{font-size:2.0em}
	.centering{display:flex;justify-content:center;}
	.navbar{
		margin-bottom:0;
		border-radius:0;
		}
	.carousel-caption{
		top:50%;
		transform: translateY(-50%);
		text-transform:uppercase;
	}
	.btn{
		font-size:18px;
		color:black;
		padding:12px 22px;
		background:white;
		border: 2px solid black;
	}
	.navbar-inverse .navbar-nav .active a, .navbar-inverse .navbar-nav .active a:focus
		, .navbar-inverse .navbar-nav .active a:hover{
		background-color:#222;
		color:#FFF;
		
		}
	h1{color:black}
	.navbar-brand{
	float:left;
	min-height:55px;
	padding:1px 15px 15px;
	}
	footer{
	width:100%;
	background-color:black;
	margin-top:5px;
	padding:5%;
	color:white;
	}
	.fa{
		padding:15px;
		font-size:25px;
		color:white;
	}
	.fa:hover{
		color:#D5D5D5;
		text-decoration:none;
	}
	
	@media (max-width:900px){
	.fa{
		font-size:20px;
		padding:10px;
		}
	}
	@media (max-width:600px){
		.carousel-caption{display: none}
	}
	
  </style>
</head>
<body>
<nav class="navbar navbar-inverse">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href=""><img src="../../../images/s.png"></a>
		</div>
		<div id="myNavbar" class="collapse navbar-collapse">
				<ul class="nav navbar-nav navbar-right">
					<li class=active><a href="../../index.php">Home</a></li>
					<li><a href="../tetris/index.php">Tetris</a></li>
					<li><a href="../jsuttt/index.html">Ultimate TicTacToe</a></li>
					<li><a href="../jsSnake/index.php">Snake Game</a></li>
					<li><a href="../movieSearching/index.html">Movie Searching</a></li>
					<li><a href="../GeneticAlgorithm/index.html">Genetic </a></li>
				</ul>
		</div>
	</div>
</nav>
<div class="container ">
<h1 class="text-center">Movie Searching Tool</h2>
<div id="myCarousel" class="carousel slide" data-ride"carousel">
	<ol class="carousel-indicators">
		<li data-target="#myCarousel" data-slide-to="0" class="active"></li>
		<li data-target="#myCarousel" data-slide-to="1"></li>
		<li data-target="#myCarousel" data-slide-to="2"></li>
	</ol>
	<div class="carousel-inner" role="listbox">
		<div class="item active">
			<img src="../../../images/movieLarge.png" alt="">
			<div class="carousel-caption">
				<h1>Download by Clicking on the button below</h1>
				<br>
				<a href="movieSearch.zip" id="download">
				<button type="button"  class="btn btn-default"><span class="glyphicon glyphicon-download"></span>&nbsp&nbspDownload</button>
				</a>
			</div>
		</div>
		<div class="item">
			<img src="../../../images/database.jpg" alt="">
		</div>
		<div class="item">
			<img src="../../../images/IDE.jpg" alt="">
		</div>	
	</div>
	<a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
	<span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
	<span class="sr-only">Preivous</span></a>
	<a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
	<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
	<span class="sr-only">Next</span></a>
</div><!--end slider-->
<div class="containe-fluid">
<div class"row">
<div class="jumbotron col-sm-12 col-md-6 col-lg-6 centering" id="description"><p>
An executable jar file connect to my cpanel database, fetch the imdb database, with sorting methods base on the publish year and genre
please unzip the file and run MovieSearch.jar in dist folder(JDK required)<br><br><br>
Tools And Methods: Java, JavaFX, JDBC, MVC developing pattern</p>
</div> 
<div class="jumbotron col-sm-12 col-md-6 col-lg-6" >
<form><textarea id="code">
/* Controller.java
==============
PURPOSE: main controller  
AUTHOR:Jainlin Luo
CREATED: 2017-09-23
UPDATED: 
*/
package luojianl;

import javafx.collections.FXCollections;
import javafx.collections.ObservableList;
import javafx.fxml.FXML;
import javafx.scene.control.*;
import javafx.scene.control.TextField;
import javafx.scene.control.cell.PropertyValueFactory;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.util.ArrayList;
import java.util.HashMap;
import javafx.beans.binding.Bindings;

public class Controller {
    @FXML
    private RadioButton r1,r2,r3,r4,r5,r6,r7,r8,r9,r10,r11,r12,r13,r14,r15,r16,r17,r18,r19,r20,
            r21,r22,r23,r24,r25,r26,r27,r28;
    @FXML
    private Label count;
    @FXML
    private ComboBox yearBox;
    @FXML
    private TextField url,user,pass;
    @FXML
    private TableView<Movie> tbv;
    @FXML
    private TableColumn<Movie,String> colTitle,colRun,colYear;
    @FXML
    private Button connect;
    
    private static HashMap<String,Integer> idMatch;
    //obsList is the List displayed in our tableView,we add movie items in it
    private ObservableList<Movie> obsList= FXCollections.observableArrayList();
    //conList is a Stirng Oberservabale List only giving oberservable item to 
    //bind with some disableProperties.
    private ObservableList<String> conList=FXCollections.observableArrayList();
   //yearList is the observable list for the year comboBox 
    private ObservableList<Integer> yearList=FXCollections.observableArrayList();
    //toogle group for all the radio butons
    private ToggleGroup tg=new ToggleGroup();
	
    
    public void initialize(){
        initIdMatch();
        conList.add("notConnect");
        //add all the radio buttons into toggle group;
        r1.setToggleGroup(tg);r2.setToggleGroup(tg);r3.setToggleGroup(tg);
        r4.setToggleGroup(tg);r5.setToggleGroup(tg);r6.setToggleGroup(tg);
        r7.setToggleGroup(tg);r8.setToggleGroup(tg);r9.setToggleGroup(tg);
        r10.setToggleGroup(tg);r11.setToggleGroup(tg);r12.setToggleGroup(tg);
        r13.setToggleGroup(tg);r14.setToggleGroup(tg);r15.setToggleGroup(tg);
        r16.setToggleGroup(tg);r17.setToggleGroup(tg);r18.setToggleGroup(tg);
        r19.setToggleGroup(tg);r20.setToggleGroup(tg);r21.setToggleGroup(tg);
        r22.setToggleGroup(tg);r23.setToggleGroup(tg);r24.setToggleGroup(tg);
        r25.setToggleGroup(tg);r26.setToggleGroup(tg);r27.setToggleGroup(tg);
        r28.setToggleGroup(tg);
        //bind the tableview columns with differnt properties
        colRun.setCellValueFactory(new PropertyValueFactory<>("runningTime"));
        colTitle.setCellValueFactory(new PropertyValueFactory<>("title"));
        colYear.setCellValueFactory(new PropertyValueFactory<>("year"));
        
       //set the year combo list items
        tbv.setItems(obsList);
        for(int i=1874;i<=2017;i++){
        yearList.add((Integer)i);
        }
        yearBox.setItems(yearList);
        //the default selected year is 2017;
        yearBox.getSelectionModel().select((Integer)2017);
        //the default selected button is "any "button
        r1.setSelected(true);
        //disable all the combo box and radio buttons before any connection established
       for(Toggle t:tg.getToggles()){
           if (t instanceof RadioButton) {
                        ((RadioButton) t).disableProperty().bind(Bindings.stringValueAt(conList,0).isEqualTo("notConnect"));
            }
       }
        yearBox.disableProperty().bind(Bindings.stringValueAt(conList,0).isEqualTo("notConnect"));
    }
     JdbcHelper jdbc=new JdbcHelper();
     
 
 //initIDMatch is a method to start up a hashmap mapping genre id to Genre Name
    private static void initIdMatch(){
        idMatch=new HashMap<String,Integer>();
        idMatch.put("Action",1);idMatch.put("Adventure",2);idMatch.put("Adult",3);idMatch.put("Animation",4);
        idMatch.put("Comedy",5);idMatch.put("Crime",6);idMatch.put("Documentary",7);idMatch.put("Drama",8);
        idMatch.put("Fantasy",9);idMatch.put("Family",10);idMatch.put("Film-Noir",11);idMatch.put("Horror",12);
        idMatch.put("Musical",13);idMatch.put("Mystery",14);idMatch.put("Romance",15);idMatch.put("Sci-Fi",16);
        idMatch.put("Short",17);idMatch.put("Thriller",18);idMatch.put("War",19);idMatch.put("Western",20);
        idMatch.put("Biography",21);idMatch.put("History",22);idMatch.put("Sport",23);idMatch.put("Reality-TV",24);
        idMatch.put("News",25);idMatch.put("Talk-Show",26);idMatch.put("Game-Show",27);
    }
    
    //Connectbutton is a method bind to "connnect", it will establish a connection with 
    //DB, disconnect if alreday connected, and throws alert window if things go wrong
    @FXML
    public void connectButton()throws Exception{
        if(connect.getText().equals("Connect")){
        String link=url.getText();
        String use=user.getText();
        String password=pass.getText();
        if(jdbc.connect(link,use,password)){
            setGenre();
            tbv.refresh();
            connect.setText("Disconnect");
            conList.clear();
            conList.add("Connect");
        }
        else{
            Alert alert=new Alert(Alert.AlertType.WARNING);
            alert.setTitle("ERROR");
            alert.setHeaderText(null);
            alert.setContentText("User or Pass Incorrect  "+jdbc.getMsg());
            alert.showAndWait();
            }
        }
        else {
            jdbc.disconnect();
            connect.setText("Connect");
            obsList.clear();
            conList.clear();
            conList.add("notConnect");
            count.setText("");
            }
    }
    //to display different rows in DB in my tableview base on the genre/year chosen
    public void setGenre()throws Exception{
        obsList.clear();
        RadioButton selected=(RadioButton)tg.getSelectedToggle();
        String genreRadio=selected.getText();
        Integer selectedYear;
        selectedYear=(Integer)yearBox.getSelectionModel().getSelectedItem();
        String title;
        ArrayList<String> genres=new ArrayList<>();
        int year;
        int runTime;
        if(genreRadio.equals("Any")){
            String sql="SELECT * FROM Movie WHERE year=?";
            PreparedStatement pstmt=jdbc.connection.prepareStatement(sql);
            pstmt.setInt(1,selectedYear);
            ResultSet resultSet=pstmt.executeQuery();
            while (resultSet.next()){
                title=resultSet.getString("title");
                year=resultSet.getInt("year");
                runTime=resultSet.getInt("runningTime");
                Movie movie=new Movie(title,year,runTime,genres);
                obsList.add(movie);
            }
            count.setText(String.valueOf(obsList.size()));
        }
        else{
            String sql="SELECT * FROM Movie INNER JOIN MovieGenre ON Movie.id=MovieGenre.movieId WHERE (MovieGenre.genreId=? AND year=?)";
            Integer genreId=idMatch.get(genreRadio);
            PreparedStatement pstmt=jdbc.connection.prepareStatement(sql);
            pstmt.setInt(1,genreId);
            pstmt.setInt(2,selectedYear);
            ResultSet resultSet=pstmt.executeQuery();        
            while (resultSet.next()){
                title=resultSet.getString("title");
                year=resultSet.getInt("year");
                runTime=resultSet.getInt("runningTime");
                Movie movie=new Movie(title,year,runTime,genres);
                obsList.add(movie);
                } 
            count.setText(String.valueOf(obsList.size()));
            }
        } 
    }

</textarea>
</form>
</div> 
 </div>
 </div>
 <div class="container text-center">
 <h2></h2>
 <div class="row">
 <div class="col-sm-12 col-md-6 col-lg-6">
 <p class="description">
 </p>
 
 
 </div>
 <div class="col-sm-12 col-md-6 col-lg-6">
 
 </div>
 </div>
 </div>
 <footer class="container-fluid text-center">
 <div class="row">
 <div class="col-sm-6 col-md-6 col-lg-6 col-xsm-6">
	<h3>Contact Me</h3>
	<br>
	<h4>samlaw829@gmail.com</h4>
 </div>
 <div class="col-sm-6 col-md-6 col-lg-6 col-xsm-6">
	<h3>Connect</h3>
	<a href="#" class="fa fa-facebook"></a>
	<a href="#" class="fa fa-google"></a>
	<a href="#" class="fa fa-linkedin"></a>
	<a href="#" class="fa fa-twitter"></a>
 </div>
 </div>
 <div class=row>
<div>
<br>
Sam @ 2017
 </div>
 </footer>
  <script>
var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
  mode: "javascript",
  styleActiveLine: true,
  lineNumbers: true,
 
});
</script>
</body>
</html>